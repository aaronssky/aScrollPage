/*! testGrunt Created by aron_阿伦 on 2015-03-17 */
!function(a){function b(){k=this.docEleH,l="all "+this.duration/1e3+"s",m=1/(1-this.scale)}function c(a){return new c.prototype._init(a)}function d(){var a="translate3d(0px,",b=",0)";0==arguments.length?this.style[o+"Transform"]=a+0+"px"+b:1==arguments.length?this.style[o+"Transform"]=a+arguments[0]+"px"+b:2==arguments.length?(this.style[o+"Transform"]=a+arguments[0]+"px"+b,this.style[o+"Transition"]=arguments[1]):3==arguments.length&&(this.style[o+"Transform"]=a+arguments[0]+"px"+b+" scale("+arguments[2]+")",this.style[o+"Transition"]=arguments[1]),this.style[o+"TransitionTimingFunction"]="ease-in-out"}function e(){d.apply(arguments[0],Array.prototype.slice.call(arguments).slice(1))}function f(a,b){for(var c=a.getAttribute("class"),d=c.split(" "),e=0;e<d.length;e++)if(d[e]==b)return!1;a.setAttribute("class",d.join(" ")+" "+b)}function g(a,b){for(var c=a.getAttribute("class"),d=c.split(" "),e=[],f=0;f<d.length;f++)d[f]!=b&&e.push(d[f]);a.setAttribute("class",e.join(" "))}function h(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function i(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):delete a["on"+b]}function j(){for(var a=navigator.userAgent,b=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),c=!0,d=0;d<b.length;d++)if(a.indexOf(b[d])>0){c=!1;break}return c}var k,l,m,n=document.createElement("div").style,o=function(){for(var a,b=["webkitT","MozT","msT","OT","t"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in n)return b[c].substr(0,b[c].length-1);return!1}();c.prototype={_init:function(a){return this.ele=a,this.ele.style.height=document.documentElement.clientHeight+"px",this},init:function(a){return this.initData(a?a:{}),this.bindEvent(),h(document,j()?"mousedown":"touchstart",function(a){a.preventDefault()}),this},initData:function(a){this.pages=this.ele.querySelectorAll(".page"),this.docEleH=document.documentElement.clientHeight,this.pageNow=1,this.usingScale=!0,this.isPc=j(),this.moved=!1,this.isMoving=!1,this.fn_afterSliding=[],this.fn_touchSliding=[],this.fn_startSlideToPage=[],this.scrollSuccess=!1,this.duration=500,this.mode="scale",this.scale=.8,this.threshold=100,this.slideMode="normal",this.fn_initCallback=function(){console.log("init plugin success")},this.setData(a)},setData:function(a){function c(b,c,d){return b in a&&a[b][c]&&"function"==typeof a[b][c]?a[b][c]:d}for(var d=0;d<this.pages.length;d++)this.fn_touchSliding.push(function(a){return c("fn_touchSliding",a,function(){console.log("默认事件--手指触摸滑动当前页开始,准备切换到第 "+(a+1)+" 页")})}(d)),this.fn_startSlideToPage.push(function(a){return c("fn_startSlideToPage",a,function(){console.log("默认事件--自动切换至第 "+(a+1)+" 页")})}(d)),this.fn_afterSliding.push(function(a){return c("fn_afterSliding",a,function(){console.log("默认事件--完成滑动到第 "+(a+1)+" 页")})}(d));"duration"in a?this.duration=a.duration:"","slideMode"in a&&"static"==a.slideMode?this.slideMode="static":"","usingScale"in a?this.usingScale=!!a.usingScale:"","scale"in a&&parseFloat(a.scale)>0&&parseFloat(a.scale)<=1?this.scale=parseFloat(a.scale):"","mode"in a&&("normal"==a.mode?this.usingScale=!1:"static"==a.mode&&(this.usingScale=!0,this.scale=1)),"threshold"in a?this.threshold=a.threshold:"","fn_initCallback"in a?this.fn_initCallback=a.fn_initCallback:"",b.call(this),this.fn_initCallback.call(this)},bindEvent:function(){function a(a){d.mousedown.call(d,a,c)}function b(a){d.mouseup.call(d,a,c)}function c(a){d.mousemove.call(d,a)}var d=this;h(this.ele,this.isPc?"mousedown":"touchstart",a),h(this.ele,this.isPc?"mouseup":"touchend",b)},mousedown:function(a,b){if(this.moved)return!1;"static"==this.slideMode?this.needToScroll=!0:"",a.stopPropagation(),this.setTransition(""),this.setPagesIndex(),this.originClientY=this.isPc?a.clientY:a.targetTouches[0].clientY;h(this.ele,this.isPc?"mousemove":"touchmove",b)},mouseup:function(a,b){if(i(this.ele,this.isPc?"mousemove":"touchmove",b),!this.moved)return!1;if(this.isMoving)return!1;if("static"==this.slideMode&&this.needToScroll)return this.scrollByDirection(),this.needToScroll=!1,!1;this.isMoving=!0,"static"!=this.slideMode?this.setTransition(l):"",clearTimeout(this.timer);var c,d=this.pages["next"==this.direction?this.pageNow:this.pageNow-2].style[o+"Transform"].split("px, "),f=k,g=this.pageNow-1;d&&k-Math.abs(d[1])>this.threshold?("next"==this.direction?(c=this.pageNow,f=-k,this.pageNow++):(c=this.pageNow-2,this.pageNow--),this.usingScale?e(this.pages[g],f/m,l,this.scale):e(this.pages[g],f,l),e(this.pages[c],0),this.scrollSuccess=!0,this.fn_startSlideToPage[this.pageNow-1].call(this)):("next"==this.direction&&this.pageNow<this.pages.length?(e(this.pages[this.pageNow-1],0),e(this.pages[this.pageNow],k)):this.pageNow>1&&(e(this.pages[this.pageNow-1],0),e(this.pages[this.pageNow-2],-k)),this.scrollSuccess=!1),this.revertCallback()},mousemove:function(a){return this.isMoving?!1:"static"==this.slideMode?(this.setStaticSlideDatas(a),!1):(this.isPc?"":a.clientY=a.targetTouches[0].clientY,a.preventDefault(),void(this.originClientY<a.clientY&&this.pageNow>1?("prev"!=this.direction?this.fn_touchSliding[this.pageNow-2].call(this):"",this.moved=!0,this.direction="prev",this.usingScale?e(this.pages[this.pageNow-1],(a.clientY-this.originClientY)*(1-this.scale),"",1-(1-this.scale)*(a.clientY-this.originClientY)/k):e(this.pages[this.pageNow-1],a.clientY-this.originClientY),f(this.pages[this.pageNow-2],"active"),e(this.pages[this.pageNow-2],-k-(this.originClientY-a.clientY)),this.pageNow<this.pages.length?g(this.pages[this.pageNow],"active"):""):this.originClientY>a.clientY&&this.pageNow<this.pages.length?("next"!=this.direction?this.fn_touchSliding[this.pageNow].call(this):"",this.moved=!0,this.direction="next",this.usingScale?e(this.pages[this.pageNow-1],(a.clientY-this.originClientY)*(1-this.scale),"",1+(1-this.scale)*(a.clientY-this.originClientY)/k):e(this.pages[this.pageNow-1],a.clientY-this.originClientY),f(this.pages[this.pageNow],"active"),e(this.pages[this.pageNow],k-(this.originClientY-a.clientY)),this.pageNow>1?g(this.pages[this.pageNow-2],"active"):""):(this.direction="",1==this.pageNow?(g(this.pages[1],"active"),e(this.pages[0],0)):this.pageNow==this.pages.length&&(e(this.pages[this.pages.length-1],0),g(this.pages[this.pages.length-2],"active")))))},revertPages:function(){for(var a=0;a<this.pages.length;a++)this.pages[a].style[o+"Transform"]="",this.pages[a].style[o+"Transition"]="",this.pages[a].style.zIndex="",a+1!=this.pageNow&&g(this.pages[a],"active")},setTransition:function(a){for(var b=0;b<this.pages.length;b++)this.pages[b].style[o+"Transition"]=a},setPagesIndex:function(){this.pageNow>1&&this.pageNow<this.pages.length?(this.pages[this.pageNow-1].style.zIndex=0,this.pages[this.pageNow-2].style.zIndex=1):this.pageNow==this.pages.length&&(this.pages[this.pageNow-1].style.zIndex=0,this.pages[this.pageNow-2].style.zIndex=1)},_autoScrollPage:function(a){if("next"==this.direction&&(this.pageNow>=this.pages.length||this.isMoving))return!1;if("prev"==this.direction&&(this.pageNow<=1||this.isMoving))return!1;this.setPagesIndex(),this.isMoving=!0,a.call(this);var b=this;return setTimeout(function(){e(b.pages[b.pageNow-1],0,l)},30),this.scrollSuccess=!0,this.revertCallback(),this.fn_startSlideToPage[this.pageNow-1].call(this),!0},toNextPage:function(){return this.direction="next",this._autoScrollPage(function(){e(this.pages[this.pageNow],k),f(this.pages[this.pageNow],"active"),this.usingScale?e(this.pages[this.pageNow-1],-k/m,l,this.scale):e(this.pages[this.pageNow-1],-k,l),this.pageNow++})},toPrevPage:function(){return this.direction="prev",this._autoScrollPage(function(){this.usingScale?e(this.pages[this.pageNow-1],k/m,l,this.scale):e(this.pages[this.pageNow-1],k,l),f(this.pages[this.pageNow-2],"active"),e(this.pages[this.pageNow-2],-k),this.pageNow--})},revertCallback:function(){var a=this;this.timer=setTimeout(function(){a.revertPages(),a.moved=!1,a.isMoving=!1,a.scrollSuccess?a.fn_afterSliding[a.pageNow-1].call(a):"",this.timer=0,a.direction="",a.scrollSuccess=!1,a.needToScroll=!1},this.duration)},setStaticSlideDatas:function(a){this.isPc?"":a.clientY=a.targetTouches[0].clientY,a.preventDefault(),this.moved=!0,this.originClientY<a.clientY&&this.pageNow>1?(this.originClientY=a.clientY,"next"==this.direction?this.needToScroll=!1:this.direction="prev"):this.originClientY>a.clientY&&this.pageNow<this.pages.length?(this.originClientY=a.clientY,"prev"==this.direction?this.needToScroll=!1:this.direction="next"):(this.moved=!1,this.needToScroll=!1,this.direction="")},scrollByDirection:function(){"prev"==this.direction?this.toPrevPage():"next"==this.direction&&this.toNextPage()}},c.prototype._init.prototype=c.prototype,a.ScrollPage=c}(window,void 0);